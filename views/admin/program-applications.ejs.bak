<!-- Header -->
<div class="mb-6">
    <h2 class="text-2xl font-bold text-slate-800"><%= program.name %></h2>
    <p class="text-slate-600">Review and manage program applications</p>
</div>

<!-- Program Summary Card -->
    <div class="mb-6 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="p-6 bg-gradient-to-r from-<%= program.gradientColors.from %> to-<%= program.gradientColors.to %>">
            <div class="flex items-center justify-between text-white">
                <div>
                    <h2 class="text-2xl font-bold mb-2"><%= program.name %></h2>
                    <p class="text-white/90"><%= program.description %></p>
                    <p class="text-sm text-white/80 mt-2">
                        <%= new Date(program.startDate).toLocaleDateString() %> - <%= new Date(program.endDate).toLocaleDateString() %>
                    </p>
                </div>
                <div class="text-right">
                    <div class="text-4xl font-bold"><%= applications.length %></div>
                    <div class="text-sm text-white/90">Total Applications</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-yellow-100 rounded-lg">
                    <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div>
                    <div class="text-2xl font-bold text-slate-800"><%= applications.filter(a => a.status === 'pending').length %></div>
                    <div class="text-sm text-slate-600">Pending</div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-green-100 rounded-lg">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div>
                    <div class="text-2xl font-bold text-slate-800"><%= applications.filter(a => a.status === 'approved').length %></div>
                    <div class="text-sm text-slate-600">Approved</div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-red-100 rounded-lg">
                    <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </div>
                <div>
                    <div class="text-2xl font-bold text-slate-800"><%= applications.filter(a => a.status === 'rejected').length %></div>
                    <div class="text-sm text-slate-600">Rejected</div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-blue-100 rounded-lg">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div>
                    <div class="text-2xl font-bold text-slate-800"><%= applications.filter(a => a.status === 'completed').length %></div>
                    <div class="text-sm text-slate-600">Completed</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Applications List -->
    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="p-6 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-slate-100">
            <h2 class="text-xl font-bold text-slate-800">All Applications</h2>
            <p class="text-sm text-slate-600 mt-1">Click on an application to view full details</p>
        </div>

        <div class="overflow-x-auto">
            <% if (applications && applications.length > 0) { %>
            <table class="w-full">
                <thead class="bg-slate-50 border-b border-slate-200">
                    <tr>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Applicant</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Contact</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Age/Gender</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Ward</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Applied On</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-200">
                    <% applications.forEach((app, index) => { %>
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="px-6 py-4">
                            <div class="font-medium text-slate-800"><%= app.fullName %></div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm text-slate-600"><%= app.mobileNumber %></div>
                            <% if (app.email) { %>
                            <div class="text-xs text-slate-500"><%= app.email %></div>
                            <% } %>
                        </td>
                        <td class="px-6 py-4 text-sm text-slate-600">
                            <%= app.age %> yrs / <%= app.gender %>
                        </td>
                        <td class="px-6 py-4 text-sm text-slate-600">
                            <%= app.address.ward %>
                        </td>
                        <td class="px-6 py-4 text-sm text-slate-600">
                            <%= new Date(app.applicationDate).toLocaleDateString() %>
                        </td>
                        <td class="px-6 py-4">
                            <% if (app.status === 'pending') { %>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-700">Pending</span>
                            <% } else if (app.status === 'approved') { %>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700">Approved</span>
                            <% } else if (app.status === 'rejected') { %>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700">Rejected</span>
                            <% } else if (app.status === 'completed') { %>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-700">Completed</span>
                            <% } %>
                        </td>
                        <td class="px-6 py-4">
                            <button 
                                onclick="viewApplicationDetails('<%= app._id %>')"
                                class="text-blue-600 hover:text-blue-800 font-medium text-sm hover:underline"
                            >
                                View Details →
                            </button>
                        </td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
            <% } else { %>
            <div class="text-center py-12">
                <svg class="w-16 h-16 mx-auto text-slate-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <p class="text-slate-600 font-medium">No applications received yet</p>
                <p class="text-sm text-slate-500 mt-2">Applications will appear here once citizens start applying</p>
            </div>
            <% } %>
        </div>
    </div>
            </div>

            <!-- Application Details (populated by JavaScript) -->
            <div id="applicationDetails" class="hidden"></div>
        </div>
    </div>
</div>

<script>
let currentApplicationId = null;

async function viewApplicationDetails(applicationId) {
    currentApplicationId = applicationId;
    const modal = document.getElementById('applicationModal');
    const loadingState = document.getElementById('loadingState');
    const detailsContainer = document.getElementById('applicationDetails');
    
    // Show modal and loading state
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    loadingState.classList.remove('hidden');
    detailsContainer.classList.add('hidden');
    
    try {
        const response = await fetch(`/admin/api/applications/${applicationId}`);
        const data = await response.json();
        
        if (data.success) {
            renderApplicationDetails(data.application);
            loadingState.classList.add('hidden');
            detailsContainer.classList.remove('hidden');
        } else {
            throw new Error(data.message || 'Failed to load application');
        }
    } catch (error) {
        console.error('Error loading application:', error);
        detailsContainer.innerHTML = `
            <div class="text-center py-12">
                <svg class="w-16 h-16 mx-auto text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-red-600 font-medium">Failed to load application details</p>
                <p class="text-slate-500 text-sm mt-2">${error.message}</p>
            </div>
        `;
        loadingState.classList.add('hidden');
        detailsContainer.classList.remove('hidden');
    }
}

function renderApplicationDetails(app) {
    const detailsContainer = document.getElementById('applicationDetails');
    
    const statusColors = {
        pending: { bg: 'bg-yellow-50', badge: 'bg-yellow-500', text: 'PENDING REVIEW' },
        approved: { bg: 'bg-green-50', badge: 'bg-green-500', text: 'APPROVED' },
        rejected: { bg: 'bg-red-50', badge: 'bg-red-500', text: 'REJECTED' },
        completed: { bg: 'bg-blue-50', badge: 'bg-blue-500', text: 'COMPLETED' }
    };
    
    const status = statusColors[app.status] || statusColors.pending;
    
    const formatDate = (date) => {
        return new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    };
    
    detailsContainer.innerHTML = `
        <!-- Status Banner -->
        <div class="mb-6 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 ${status.bg}">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div>
                        <h3 class="text-2xl font-bold text-slate-800 mb-2">${app.fullName}</h3>
                        <p class="text-slate-600">Applied on ${formatDate(app.applicationDate)}</p>
                    </div>
                    <div class="text-right">
                        <span class="px-6 py-3 text-sm font-bold rounded-full ${status.badge} text-white">${status.text}</span>
                        ${app.reviewedBy && app.reviewedAt ? `
                            <p class="text-xs text-slate-600 mt-2">Reviewed by ${app.reviewedBy.name} on ${formatDate(app.reviewedAt)}</p>
                        ` : ''}
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Details -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Personal Information -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-slate-200">
                        <h4 class="font-bold text-slate-800 flex items-center gap-2">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Personal Information
                        </h4>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Full Name</p>
                                <p class="text-slate-800 font-medium">${app.fullName}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Date of Birth</p>
                                <p class="text-slate-800 font-medium">${formatDate(app.dateOfBirth)}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Age</p>
                                <p class="text-slate-800 font-medium">${app.age} years</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Gender</p>
                                <p class="text-slate-800 font-medium capitalize">${app.gender}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Mobile Number</p>
                                <p class="text-slate-800 font-medium">${app.mobileNumber}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Email</p>
                                <p class="text-slate-800 font-medium">${app.email || 'Not provided'}</p>
                            </div>
                            ${app.aadharNumber ? `
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Aadhar Number</p>
                                <p class="text-slate-800 font-medium">${app.aadharNumber}</p>
                            </div>
                            ` : ''}
                            ${app.bloodGroup ? `
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Blood Group</p>
                                <p class="text-slate-800 font-medium">${app.bloodGroup}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <!-- Address Information -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 bg-gradient-to-r from-purple-50 to-pink-50 border-b border-slate-200">
                        <h4 class="font-bold text-slate-800 flex items-center gap-2">
                            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Address Details
                        </h4>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="col-span-2">
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Street Address</p>
                                <p class="text-slate-800 font-medium">${app.address.street}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Area/Locality</p>
                                <p class="text-slate-800 font-medium">${app.address.area}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Ward</p>
                                <p class="text-slate-800 font-medium">${app.address.ward}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Pincode</p>
                                <p class="text-slate-800 font-medium">${app.address.pincode}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medical Information -->
                ${app.medicalHistory || app.allergies || app.currentMedications || app.previousVaccinations ? `
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-b border-slate-200">
                        <h4 class="font-bold text-slate-800 flex items-center gap-2">
                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Medical Information
                        </h4>
                    </div>
                    <div class="p-4 space-y-3 text-sm">
                        ${app.medicalHistory ? `
                        <div>
                            <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Medical History</p>
                            <p class="text-slate-800">${app.medicalHistory}</p>
                        </div>
                        ` : ''}
                        ${app.allergies ? `
                        <div>
                            <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Allergies</p>
                            <p class="text-slate-800">${app.allergies}</p>
                        </div>
                        ` : ''}
                        ${app.currentMedications ? `
                        <div>
                            <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Current Medications</p>
                            <p class="text-slate-800">${app.currentMedications}</p>
                        </div>
                        ` : ''}
                        ${app.previousVaccinations ? `
                        <div>
                            <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Previous Vaccinations</p>
                            <p class="text-slate-800">${app.previousVaccinations}</p>
                        </div>
                        ` : ''}
                    </div>
                </div>
                ` : ''}

                <!-- Program Preferences -->
                ${app.preferredCenter || app.preferredDate ? `
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 bg-gradient-to-r from-orange-50 to-amber-50 border-b border-slate-200">
                        <h4 class="font-bold text-slate-800 flex items-center gap-2">
                            <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Program Preferences
                        </h4>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            ${app.preferredCenter ? `
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Preferred Center</p>
                                <p class="text-slate-800 font-medium">${app.preferredCenter}</p>
                            </div>
                            ` : ''}
                            ${app.preferredDate ? `
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Preferred Date</p>
                                <p class="text-slate-800 font-medium">${formatDate(app.preferredDate)}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Emergency Contact -->
                ${app.emergencyContact && app.emergencyContact.name ? `
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 bg-gradient-to-r from-red-50 to-rose-50 border-b border-slate-200">
                        <h4 class="font-bold text-slate-800 flex items-center gap-2">
                            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                            </svg>
                            Emergency Contact
                        </h4>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Contact Name</p>
                                <p class="text-slate-800 font-medium">${app.emergencyContact.name}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Relation</p>
                                <p class="text-slate-800 font-medium">${app.emergencyContact.relation || 'Not specified'}</p>
                            </div>
                            <div>
                                <p class="text-xs font-semibold text-slate-500 uppercase mb-1">Phone Number</p>
                                <p class="text-slate-800 font-medium">${app.emergencyContact.phone}</p>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
            </div>

            <!-- Action Panel -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden sticky top-6">
                    <div class="p-4 bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200">
                        <h4 class="font-bold text-slate-800">Actions</h4>
                    </div>
                    <div class="p-4">
                        ${app.status === 'pending' ? `
                        <div class="space-y-3 mb-4">
                            <button 
                                onclick="updateApplicationStatus('${app._id}', 'approved')" 
                                class="w-full px-4 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 text-sm"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Approve Application
                            </button>
                            <button 
                                onclick="updateApplicationStatus('${app._id}', 'rejected')" 
                                class="w-full px-4 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center gap-2 text-sm"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                Reject Application
                            </button>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Review Notes</label>
                            <textarea 
                                id="reviewNotes" 
                                rows="4" 
                                class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-sm"
                                placeholder="Add notes about your decision..."
                            ></textarea>
                        </div>
                        ` : `
                        <div class="mb-4">
                            <p class="text-sm text-slate-600 mb-3">This application has been <strong class="capitalize">${app.status}</strong></p>
                            ${app.status === 'approved' || app.status === 'rejected' ? `
                            <button 
                                onclick="updateApplicationStatus('${app._id}', 'pending')" 
                                class="w-full px-4 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition-colors text-sm mb-2"
                            >
                                Reset to Pending
                            </button>
                            ` : ''}
                            ${app.status === 'approved' ? `
                            <button 
                                onclick="updateApplicationStatus('${app._id}', 'completed')" 
                                class="w-full px-4 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors text-sm"
                            >
                                Mark as Completed
                            </button>
                            ` : ''}
                        </div>
                        ${app.reviewNotes ? `
                        <div class="bg-slate-50 rounded-lg p-4">
                            <p class="text-xs font-semibold text-slate-500 uppercase mb-2">Review Notes</p>
                            <p class="text-sm text-slate-700">${app.reviewNotes}</p>
                        </div>
                        ` : ''}
                        `}
                    </div>
                </div>
            </div>
        </div>
    `;
}

async function updateApplicationStatus(applicationId, newStatus) {
    const notes = document.getElementById('reviewNotes')?.value || '';
    
    const confirmMessages = {
        'approved': 'Are you sure you want to approve this application?',
        'rejected': 'Are you sure you want to reject this application?',
        'completed': 'Mark this application as completed?',
        'pending': 'Reset this application to pending?'
    };
    
    if (!confirm(confirmMessages[newStatus])) {
        return;
    }
    
    try {
        const response = await fetch(`/admin/applications/${applicationId}/status`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ status: newStatus, notes })
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('✅ ' + result.message);
            closeModal();
            // Reload the page to update the applications list
            window.location.reload();
        } else {
            alert('❌ ' + (result.message || 'Failed to update status'));
        }
    } catch (error) {
        console.error('Error:', error);
        alert('❌ An error occurred. Please try again.');
    }
}

function closeModal() {
    const modal = document.getElementById('applicationModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    currentApplicationId = null;
}

function closeModalOnOutsideClick(event) {
    if (event.target.id === 'applicationModal') {
        closeModal();
    }
}

// Close modal on Escape key
document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
        closeModal();
    }
});
</script>